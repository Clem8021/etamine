<%= render "shared/navbar" %>

<div class="order-confirmation-container">
  <div class="confirmation-card">

    <!-- ðŸ”¹ En-tÃªte -->
    <div class="confirmation-header">
      <h1>ðŸ§¾ DÃ©tail de la commande</h1>

      <p>
        Commande <strong>nÂ°<%= @order.id %></strong>
        passÃ©e le <%= l(@order.created_at, format: :long) %>
      </p>

      <span class="order-status <%= @order.status %>">
        <%= @order.status.capitalize %>
      </span>
    </div>

    <!-- ðŸ‘¤ CoordonnÃ©es -->
    <div class="confirmation-section">
      <h2>ðŸ‘¤ CoordonnÃ©es</h2>
      <p><strong>Nom :</strong>
        <%= @order.full_name.presence || current_user&.first_name || "â€”" %>
      </p>
      <p><strong>Email :</strong>
        <%= @order.email.presence || current_user&.email || "â€”" %>
      </p>
    </div>

    <!-- ðŸšš Livraison / Retrait -->
    <% if @order.delivery_detail.present? %>
      <div class="confirmation-section">
        <h2>ðŸšš Livraison / Retrait</h2>

        <p>
          <strong>Mode :</strong>
          <%= @order.delivery_detail.mode == "delivery" ?
              "Livraison Ã  domicile" :
              "Retrait en boutique" %>
        </p>

        <% if @order.delivery_detail.date.present? %>
          <p>
            <strong>Date :</strong>
            <%= l(@order.delivery_detail.date, format: :long) %>
          </p>
        <% end %>

        <% if @order.delivery_detail.time_slot.present? %>
          <p>
            <strong>CrÃ©neau :</strong>
            <%= @order.delivery_detail.time_slot == "morning" ?
                "Matin (9h â€“ 12h30)" :
                "AprÃ¨s-midi (14h â€“ 19h)" %>
          </p>
        <% end %>

        <% if @order.delivery_detail.mode == "delivery" %>
          <p>
            <strong>Adresse :</strong><br>
            <%= @order.delivery_detail.recipient_address %><br>
            <%= @order.delivery_detail.recipient_zip %>
            <%= @order.delivery_detail.recipient_city %>
          </p>
        <% end %>

        <% if @order.delivery_detail.notes.present? %>
          <p><strong>Notes :</strong> <%= @order.delivery_detail.notes %></p>
        <% end %>
      </div>
    <% end %>

    <!-- ðŸ›’ Articles -->
    <div class="confirmation-section">
      <h2>ðŸ›’ Articles commandÃ©s</h2>

      <ul class="order-items-list">
        <% @order.order_items.each do |item| %>
          <li class="order-item">
            <%= image_tag item.product.display_image,
                  alt: item.product.name,
                  class: "product-thumb" %>

            <div class="item-info">
              <p class="item-name"><%= item.product.name %></p>

              <p class="item-meta">
                <%= item.quantity %> Ã—
                <%= number_to_currency(item.price_cents / 100.0, unit: "â‚¬") %>
              </p>

              <% if item.size.present? %>
                <p><strong>Taille :</strong> <%= item.size %></p>
              <% end %>

              <% if item.addons.present? %>
                <p class="addons">
                  <em>Options :</em> <%= item.addons.join(", ") %>
                </p>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>

    <!-- ðŸ’¶ Totaux -->
    <div class="confirmation-section total-box">
      <h2>ðŸ’¶ RÃ©capitulatif</h2>

      <p>
        <strong>Total TTC :</strong>
        <%= number_to_currency(@order.total_due, unit: "â‚¬") %>
      </p>
    </div>

    <!-- ðŸ”˜ Actions -->
    <div class="confirmation-actions">
      <%= link_to "â† Retour Ã  la boutique",
            boutique_path,
            class: "btn btn-secondary" %>

      <%= link_to "ðŸ“¦ Mes commandes",
            orders_path,
            class: "btn btn-primary" %>
    </div>

  </div>
</div>
