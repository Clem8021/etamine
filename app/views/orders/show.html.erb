<%= render "shared/navbar" %>

<div class="admin-order-details">
  <h1>Commande n°<%= @order.id %></h1>

  <h3>👤 Client</h3>
  <p><strong>Nom :</strong> <%= @order.full_name %></p>
  <p><strong>Email :</strong> <%= @order.email %></p>
  <p><strong>Téléphone :</strong> <%= @order.phone_number %></p>
  <p><strong>Adresse :</strong> <%= @order.address %></p>

  <% if @order.delivery_detail %>
    <h3>🚚 Livraison / Retrait</h3>
    <p><strong>Mode :</strong> <%= @order.delivery_detail.mode == "delivery" ? "Livraison" : "Retrait en boutique" %></p>
    <p><strong>Date :</strong> <%= l(@order.delivery_detail.date, format: :long) %></p>
    <% if @order.delivery_detail.time_slot.present? %>
      <p><strong>Créneau :</strong> <%= @order.delivery_detail.time_slot %></p>
    <% end %>
  <% end %>

  <h3>🛒 Articles</h3>
  <ul class="order-items">
    <% @order.order_items.each do |item| %>
      <li>
        <%= image_tag item.product.image_url, class: "product-thumb" %>
        <strong><%= item.product.name %></strong> –
        <%= item.quantity %> × <%= number_to_currency(item.price_cents / 100.0, unit: "€") %>
        <% if item.addons.present? %>
          <br><em>Options :</em> <%= item.addons.join(", ") %>
        <% end %>
      </li>
    <% end %>
  </ul>

  <h3>💶 Récapitulatif</h3>
  <p><strong>Sous-total :</strong> <%= number_to_currency(@order.subtotal_cents / 100.0, unit: "€") %></p>
  <p><strong>Frais de livraison :</strong> <%= number_to_currency(@order.delivery_fee_cents / 100.0, unit: "€") %></p>
  <p class="total"><strong>Total à payer :</strong> <%= number_to_currency(@order.total_due, unit: "€") %></p>

  <h3>⚙️ Actions</h3>
  <%= form_with model: @order, url: order_path(@order), method: :patch, local: true do |f| %>
    <%= f.label :status, "Statut de la commande" %>
    <%= f.select :status, Order::STATUSES, {}, class: "form-control" %>
    <%= f.submit "Mettre à jour", class: "btn btn-secondary" %>
  <% end %>

  <%= link_to "⬅ Retour aux commandes", orders_path, class: "btn btn-outline" %>
</div>
