<%= render "shared/navbar" %>

<div class="order-show-container">
  <h1 class="order-title">Commande n¬∞<%= @order.id %></h1>

  <!-- üßç Informations client -->
  <section class="order-section">
    <h2><i class="fa-solid fa-user"></i> Client</h2>
    <div class="info-grid">
      <p><strong>Nom :</strong> <%= @order.full_name %></p>
      <p><strong>Email :</strong> <%= @order.email %></p>
      <p><strong>T√©l√©phone :</strong> <%= @order.phone_number %></p>
      <p><strong>Adresse :</strong> <%= @order.address %></p>
    </div>
  </section>

  <!-- üöö Livraison / Retrait -->
  <% if @order.delivery_detail %>
    <section class="order-section">
      <h2><i class="fa-solid fa-truck"></i> Livraison / Retrait</h2>
      <p><strong>Mode :</strong> <%= @order.delivery_detail.mode == "delivery" ? "Livraison" : "Retrait en boutique" %></p>
      <p><strong>Date :</strong> <%= l(@order.delivery_detail.date, format: :long) %></p>
      <% if @order.delivery_detail.time_slot.present? %>
        <p><strong>Cr√©neau :</strong> <%= @order.delivery_detail.time_slot %></p>
      <% end %>
    </section>
  <% end %>

  <!-- üõçÔ∏è Articles command√©s -->
  <section class="order-section">
    <h2><i class="fa-solid fa-basket-shopping"></i> Articles</h2>
    <ul class="order-items">
      <% @order.order_items.each do |item| %>
        <li class="order-item">
          <%= image_tag item.product.image_url, class: "product-thumb" %>
          <div class="item-info">
            <strong><%= item.product.name %></strong><br>
            <span><%= item.quantity %> √ó <%= number_to_currency(item.price_cents / 100.0, unit: "‚Ç¨") %></span>
            <% if item.addons.present? %>
              <br><em>Options :</em> <%= item.addons.join(", ") %>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
  </section>

  <!-- üí∂ R√©capitulatif -->
  <section class="order-section summary">
    <h2><i class="fa-solid fa-euro-sign"></i> R√©capitulatif</h2>
    <p><strong>Sous-total :</strong> <%= number_to_currency(@order.subtotal_cents / 100.0, unit: "‚Ç¨") %></p>
    <p><strong>Frais de livraison :</strong> <%= number_to_currency(@order.delivery_fee_cents / 100.0, unit: "‚Ç¨") %></p>
    <p class="total"><strong>Total √† payer :</strong> <%= number_to_currency(@order.total_due, unit: "‚Ç¨") %></p>
  </section>

  <!-- ‚öôÔ∏è Bloc r√©serv√© √† l‚Äôadmin -->
  <% if current_user.admin? %>
    <section class="order-section admin-panel">
      <h2><i class="fa-solid fa-gear"></i> Actions administrateur</h2>
      <%= form_with model: @order, url: order_path(@order), method: :patch, local: true do |f| %>
        <div class="form-group">
          <%= f.label :status, "Statut de la commande" %>
          <%= f.select :status, Order::STATUSES, {}, class: "form-control" %>
        </div>
        <%= f.submit "Mettre √† jour", class: "btn btn-secondary" %>
      <% end %>
    </section>
  <% end %>

  <div class="back-link">
    <%= link_to "‚¨Ö Retour aux commandes", orders_path, class: "btn btn-outline" %>
  </div>
</div>
