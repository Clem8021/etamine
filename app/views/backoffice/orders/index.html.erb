<%= render "shared/navbar" %>

<div class="admin-container">
  <header class="admin-header">
    <h1 class="admin-title">ğŸ“¦ Commandes payÃ©es</h1>
    <p class="admin-subtitle">
      <%= @orders.count %> commande(s) confirmÃ©e(s)
    </p>
  </header>

  <% if @orders.any? %>
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Client</th>
            <th>Montant</th>
            <th>Livraison</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% @orders.each do |order| %>
            <tr>
              <td class="order-id">#<%= order.id %></td>

              <td><%= l(order.created_at, format: :short) %></td>

              <td>
                <% delivery = order.delivery_detail %>

                <strong>
                  <%= order.full_name.presence ||
                      [delivery&.recipient_firstname, delivery&.recipient_name].compact.join(" ") ||
                      "InvitÃ©" %>
                </strong><br>

                <small class="muted">
                  <%= order.email.presence || delivery&.recipient_email %>
                </small>
              </td>

              <td class="amount">
                <%= number_to_currency(order.total_due, unit: "â‚¬") %>
              </td>

              <td>
                <% if order.delivery_detail&.mode == "delivery" %>
                  <span class="badge badge-delivery">ğŸšš Livraison</span>
                <% else %>
                  <span class="badge badge-pickup">ğŸª Retrait</span>
                <% end %>
              </td>

              <td class="actions">
                <%= link_to "Voir",
                  backoffice_order_path(order),
                  class: "btn btn-sm btn-outline" %>

                <%= button_to "Archiver",
                  backoffice_order_path(order),
                  method: :delete,
                  data: { turbo_confirm: "Archiver cette commande ? (elle sera visible dans la section ArchivÃ©es)" },
                  class: "btn btn-sm btn-danger" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <p>ğŸŒ¸ Aucune commande payÃ©e pour le moment.</p>
    </div>
  <% end %>

  <%# ===================== %>
  <%# SECTION ARCHIVÃ‰ES     %>
  <%# ===================== %>

  <header class="admin-header" style="margin-top: 2rem;">
    <h2 class="admin-title">ğŸ—„ï¸ Commandes archivÃ©es</h2>
    <p class="admin-subtitle">
      <%= @archived_orders.count %> commande(s) archivÃ©e(s)
    </p>
  </header>

  <% if @archived_orders.any? %>
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Client</th>
            <th>Montant</th>
            <th>Livraison</th>
            <th>ArchivÃ©e le</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% @archived_orders.each do |order| %>
            <tr>
              <td class="order-id">#<%= order.id %></td>

              <td><%= l(order.created_at, format: :short) %></td>

              <td>
                <% delivery = order.delivery_detail %>

                <strong>
                  <%= order.full_name.presence ||
                      [delivery&.recipient_firstname, delivery&.recipient_name].compact.join(" ") ||
                      "InvitÃ©" %>
                </strong><br>

                <small class="muted">
                  <%= order.email.presence || delivery&.recipient_email %>
                </small>
              </td>

              <td class="amount">
                <%= number_to_currency(order.total_due, unit: "â‚¬") %>
              </td>

              <td>
                <% if order.delivery_detail&.mode == "delivery" %>
                  <span class="badge badge-delivery">ğŸšš Livraison</span>
                <% else %>
                  <span class="badge badge-pickup">ğŸª Retrait</span>
                <% end %>
              </td>

              <td>
                <%= order.archived_at ? l(order.archived_at, format: :short) : "-" %>
              </td>

              <td class="actions">
                <%= link_to "Voir",
                  backoffice_order_path(order),
                  class: "btn btn-sm btn-outline" %>

                <%= button_to "Restaurer",
                  unarchive_backoffice_order_path(order),
                  method: :patch,
                  class: "btn btn-sm btn-outline" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <p>ğŸ«§ Aucune commande archivÃ©e.</p>
    </div>
  <% end %>
</div>

<%= link_to "â† Retour au backoffice",
  backoffice_root_path,
  class: "btn btn-outline" %>
