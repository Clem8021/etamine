<%= form_with model: [:backoffice, product], class: "admin-form" do |f| %>
  <% if product.errors.any? %>
    <div class="alert alert-danger" style="margin-bottom: 16px;">
      <strong>Impossible d’enregistrer :</strong>
      <ul>
        <% product.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :name, "Nom" %>
    <%= f.text_field :name, class: "input", placeholder: "Ex : Bouquet Printemps" %>
  </div>

  <div class="form-group">
    <%= f.label :category, "Catégorie" %>
    <%= f.select :category,
          Product::CATEGORIES.map { |c| [Product.category_label(c), c] },
          { include_blank: "Choisir..." },
          class: "input" %>
  </div>

  <div class="form-group">
    <%= f.label :variety, "Variété (uniquement roses)" %>
    <%= f.select :variety,
          Product::ROSE_VARIETIES.map { |v| [v.titleize, v] },
          { include_blank: "Aucune" },
          class: "input" %>
    <small class="muted">Laisse vide si ce n’est pas une rose.</small>
  </div>

  <hr style="margin: 16px 0;" />

  <div class="form-group">
    <%= f.label :price_cents, "Prix de base (centimes)" %>
    <%= f.number_field :price_cents, class: "input", step: 1, min: 0 %>
    <small class="muted">Ex : 2500 = 25,00€</small>
  </div>

  <div class="form-group">
    <%= f.label :price_options_text, "Options de prix (1 ligne = 1 option)" %>

    <%= f.text_area :price_options_text,
          value: (product.price_options.is_a?(Hash) ? product.price_options.map { |k,v| "#{k}: #{(v.to_i / 100.0).to_s.tr('.', ',')}" }.join("\n") : ""),
          class: "input",
          rows: 6,
          placeholder: "25€: 25\n30€: 30\n35€: 35" %>

    <small class="muted">Format : Libellé: prix en euros (ex: 25€: 25 ou Grand: 90)</small>
  </div>

  <div class="form-group">
    <%= f.label :color_options, "Couleurs — séparées par virgules" %>
    <%= f.text_field :color_options, class: "input", placeholder: "Rouge, Blanc, Rose" %>
  </div>

  <div class="form-group">
    <%= f.label :addons, "Options (séparés par virgules)" %>
    <%= f.text_field :addons, class: "input", placeholder: "Gypsophile (+2€), Ruban deuil" %>
  </div>

  <div class="form-group">
    <%= f.label :message_card_ids, "Cartes messages" %><br>
    <%= f.collection_check_boxes :message_card_ids, MessageCard.all, :id, :name do |cb| %>
      <div class="checkbox">
        <%= cb.check_box %>
        <%= cb.label %>
      </div>
    <% end %>
  </div>

  <div class="form-group">
    <%= f.label :photo, "Photo du produit" %>
    <%= f.file_field :photo, accept: "image/*", id: "product_photo" %>
  </div>


  <div class="form-group" style="display:flex; gap:10px; align-items:center; margin-top: 10px;">
    <%= f.check_box :active %>
    <%= f.label :active, "Produit actif (visible en boutique)" %>
  </div>

  <div style="display:flex; gap:10px; margin-top: 16px;">
    <%= f.submit (product.persisted? ? "Enregistrer" : "Créer"),
          class: "btn btn-primary" %>

    <%= link_to "Annuler",
          backoffice_products_path,
          class: "btn btn-outline" %>
  </div>
<% end %>
