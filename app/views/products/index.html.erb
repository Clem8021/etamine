<%= render "shared/navbar" %>

<div class="boutique">

  <!-- Titre (apr√®s les filtres) -->
  <h1 class="section-title">
    <%= image_tag "pastille_rose.png", alt: "Logo √âtamine", class: "title-icon" %>
    <span>Notre Boutique</span>
  </h1>

  <!-- Filtres cat√©gories -->
  <div class="category-filters">
    <%= link_to "Tous",
                boutique_path,
                class: "btn #{'btn-active' if params[:category].blank?}" %>

    <% Product::CATEGORIES.each do |cat| %>
      <% is_noel = (cat == "noel") %>
      <% is_valentin = (cat == "saint-valentin") %>

      <%= link_to boutique_path(category: cat),
                  class: "btn #{'btn-active' if params[:category] == cat} #{'noel-btn' if is_noel} #{'valentin-btn' if is_valentin}" do %>
        <%= Product.category_label(cat) %>

        <% if is_noel %>
          <span class="star">‚ú®</span>
          <span class="star">‚ú®</span>
          <span class="star">‚ú®</span>
          <span class="star">‚ú®</span>
        <% end %>

        <% if is_valentin %>
          <span class="heart">‚ù§Ô∏è</span>
          <span class="heart">üíó</span>
          <span class="heart">‚ù§Ô∏è</span>
          <span class="heart">üíó</span>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <!-- Cat√©gories + produits -->
  <% @products_by_category.each do |category, products| %>
    <h2 class="category-title"><%= Product.category_label(category) %></h2>

    <div class="products-grid">
      <% if category == "roses" %>
        <% products.group_by(&:variety).each do |variety, grouped| %>
          <% next if variety.nil? %>
          <% product = grouped.first %>

          <div class="product-macaron">
            <%= image_tag(
                  (product.photo.attached? ? url_for(product.photo) : product.display_image_url),
                  alt: product.name,
                  class: "product-image"
                ) %>

            <div class="product-info">
              <h3 class="product-name"><%= variety.to_s.capitalize %></h3>
              <p class="product-price">
                √Ä partir de <%= number_to_currency(product.starting_price_cents / 100.0, unit: "‚Ç¨") %>
              </p>
              <%= link_to "Voir", product_path(product), class: "btn" %>
            </div>
          </div>
        <% end %>
      <% else %>
        <% products.each do |product| %>
          <div class="product-macaron">
            <%= image_tag(
                  (product.photo.attached? ? url_for(product.photo) : product.display_image_url),
                  alt: product.name,
                  class: "product-image"
                ) %>

            <div class="product-info">
              <h3 class="product-name"><%= product.name %></h3>
              <p class="product-price">
                <% if product.price_options.present? %>
                  √Ä partir de <%= number_to_currency(product.min_price_cents / 100.0, unit: "‚Ç¨") %>
                <% elsif product.price_cents.present? %>
                  <%= number_to_currency(product.price_euros, unit: "‚Ç¨") %>
                <% else %>
                  Prix non d√©fini
                <% end %>
              </p>
              <%= link_to "Voir", product_path(product), class: "btn" %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- Encadr√© info -->
  <div class="floral-info-box">
    <%= image_tag "fleur.png", alt: "Ic√¥ne fleur", class: "floral-icon" %>
    <p>
      Les photos sont <strong>non contractuelles</strong> : les fleurs peuvent varier <strong>selon les saisons</strong>. Les contenants √©galement.
      <br>
      Pour toute autre demande, n‚Äôh√©sitez pas √† nous <strong>contacter par t√©l√©phone ou √† passer en boutique</strong>.
    </p>
  </div>
</div>
