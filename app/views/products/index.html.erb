<div class="floating-back-button">
  <%= link_to root_path, class: "back-link" do %>
    <span>‚Üê</span>
    <%= image_tag "logo.png", alt: "Logo Etamine", class: "logo-small" %>
  <% end %>
</div>

<section class="boutique">
  <h1 class="section-title">Notre Boutique</h1>

  <div class="category-filters">
    <%= link_to "Tous", products_path, class: "btn btn-secondary" %>
    <% Product::CATEGORIES.each do |category| %>
      <%= link_to Product.category_label(category), products_path(category: category), class: "btn btn-secondary" %>
    <% end %>
  </div>

  <% if params[:category].present? && @products_by_category[params[:category]] %>
    <% # Affiche uniquement la cat√©gorie s√©lectionn√©e %>
    <% category = params[:category] %>
    <% products = @products_by_category[category] %>
    <section class="category-section">
      <h2 class="category-title"><%= Product.category_label(category) %></h2>
      <div class="products-grid">
        <% products.each do |product| %>
          <div class="product-macaron">
            <%= image_tag product.image_url, alt: product.name, class: "product-image" %>
            <div class="product-info">
              <h3 class="product-name"><%= product.name %></h3>
              <p class="product-price"><%= number_to_currency(product.price_cents / 100.0, unit: "‚Ç¨") %></p>
              <%= link_to "Voir plus", product_path(product), class: "btn btn-primary", data: { turbo_frame: "product_modal" } %>
            </div>
          </div>
        <% end %>
      </div>
    </section>

  <% else %>
    <% # Affiche toutes les cat√©gories group√©es pour roses+orchidees et les autres apr√®s %>
    <% special_categories = ["roses", "orchidees"] %>

    <div class="category-group-row">
      <% special_categories.each do |category| %>
        <% products = @products_by_category[category] || [] %>
        <% next if products.empty? %>
        <div class="category-section half-width">
          <h2 class="category-title"><%= Product.category_label(category) %></h2>
          <div class="products-grid">
            <% products.each do |product| %>
              <div class="product-macaron">
                <%= image_tag product.image_url, alt: product.name, class: "product-image" %>
                <div class="product-info">
                  <h3 class="product-name"><%= product.name %></h3>
                  <p class="product-price"><%= number_to_currency(product.price_cents / 100.0, unit: "‚Ç¨") %></p>
                  <%= link_to "Voir plus", product_path(product), class: "btn btn-primary", data: { turbo_frame: "product_modal" } %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <% (@products_by_category.keys - special_categories).each do |category| %>
      <% products = @products_by_category[category] || [] %>
      <% next if products.empty? %>
      <section class="category-section">
        <h2 class="category-title"><%= Product.category_label(category) %></h2>
        <div class="products-grid">
          <% products.each do |product| %>
            <div class="product-macaron">
              <%= image_tag product.image_url, alt: product.name, class: "product-image" %>
              <div class="product-info">
                <h3 class="product-name"><%= product.name %></h3>
                <p class="product-price"><%= number_to_currency(product.price_cents / 100.0, unit: "‚Ç¨") %></p>
                <%= link_to "Voir plus", products_path(category: category), class: "btn btn-primary" %>
              </div>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
  <% end %>

  <div class="floral-info-box">
    <div class="icon">üå∑</div>
    <p>
      Les photos sont <strong>non contractuelles</strong> : les fleurs peuvent varier selon les saisons.
      <br>
      Pour toute autre demande, n‚Äôh√©sitez pas √† nous <strong>contacter par t√©l√©phone ou √† passer en boutique</strong>.
    </p>
  </div>
</section>
